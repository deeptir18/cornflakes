### Experiment runner yaml for MLX5-Netperf (submodule)

time: 10
programs:
    start_server: 
        start: sudo nice -n -19 taskset -c 1 {cornflakes_dir}/mlx5-netperf/build/mlx5-netperf  --mode=SERVER --pci_addr={pci_addr} --server_mac={server_mac} --server_ip={server_ip} --array_size={array_size} --segment_size={segment_size} --num_segments={num_segments}{with_copy} --busy_work_us={busy_cycles}{read_pkt_str}{echo_str}
        hosts: [server]
        perf: sudo perf stat -e task-clock,cycles,instructions,cache-references,cache-misses,L1-dcache-loads,L1-dcache-load-misses,L1-dcache-stores,dTLB-loads,dTLB-load-misses,dTLB-prefetch-misses,LLC-loads,LLC-load-misses,LLC-stores,LLC-store-misses -o {folder}/server.perf.log
        log:
            out: "{folder}/server.log"
            err: "{folder}/server.err.log"
            record: "{folder}/server.record.log"
        stop: sudo kill -9 `ps aux | grep  {cornflakes_dir}/mlx5-netperf/build/mlx5-netperf | grep -v grep | awk '{{print $2}}'`
    start_client:
        start: sudo LD_LIBRARY_PATH={cornflakes_dir}/dpdk-datapath/3rdparty/dpdk/build/lib/x86_64-linux-gnu {cornflakes_dir}/scatter-gather-bench/build/netperf {config_eal} -- --mode=CLIENT --server_ip={server_ip} --client_ip={client_ip} --server_mac={server_mac} --rate={rate} --segment_size={segment_size} --num_segments={num_segments} --time={time}{echo_str}  --random_seed={random_seed} --num_machines={num_machines} --machine_id={host_id} --array_size={array_size} --client_threads={num_threads}{send_packet_size_str} --log={folder}/{host}.latency-t.log --threads_log={folder}/{host}.threads.log
        hosts: [client1, client2, client3]
        log:
            out: "{folder}/{host}.log"
            err: "{folder}/{host}.err.log"
            record: "{folder}/{host}.record.log"

commands:
    - program: start_server
      begin: 0

    - program: start_client
      begin: 3
        

    
        
